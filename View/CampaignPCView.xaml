<UserControl x:Class="DMAssistant.View.CampaignPCView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:view="clr-namespace:DMAssistant.View"
             xmlns:h="clr-namespace:DMAssistant.Helpers"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <h:RemoveItemConverter x:Key="RemoveItemConverter" />
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  PreviewMouseDown="ScrollViewer_PreviewMouseDown">
        <StackPanel Margin="10">

            <!-- Header -->
            <TextBlock Text="Player Characters"
                       FontSize="20"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,10"/>

            <!-- Player List -->
            <ItemsControl ItemsSource="{Binding PlayerCharacters}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <!-- Player Border -->
                        <Border BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="10"
                                Margin="3"
                                Background="LightGray">
                            <StackPanel>
                                <!-- Player Basic Info -->
                                <TextBox Text="{Binding Name, Mode=TwoWay}"
                                         FontSize="16"
                                         FontWeight="Bold" />

                                <TextBox Text="{Binding PlayerName, Mode=TwoWay}"
                                         Margin="0,0,0,5" />

                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="HP: " FontWeight="Bold"/>
                                    <TextBox Text="{Binding Hp, Mode=TwoWay}"
                                             Width="50"/>

                                    <TextBlock Text="   AC: " FontWeight="Bold" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding ArmorClass, Mode=TwoWay}"
                                             Width="50"/>

                                    <TextBlock Text="   Passive Perception: " FontWeight="Bold" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding PassivePerseption, Mode=TwoWay}"
                                             Width="50"/>
                                </StackPanel>

                                <!-- Backstory / Goal etc. -->
                                <TextBlock Text="Backstory:" FontWeight="Bold" Margin="0,5,0,0"/>
                                <TextBox Text="{Binding Backstory, Mode=TwoWay}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"/>

                                <TextBlock Text="Goal:" FontWeight="Bold" Margin="0,5,0,0"/>
                                <TextBox Text="{Binding Goal, Mode=TwoWay}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"/>

                                <TextBlock Text="Alliances:" FontWeight="Bold" Margin="0,5,0,0"/>
                                <TextBox Text="{Binding Alliances, Mode=TwoWay}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"/>

                                <TextBlock Text="Enemies:" FontWeight="Bold" Margin="0,5,0,0"/>
                                <TextBox Text="{Binding Enemies, Mode=TwoWay}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"/>

                                <Separator Margin="5"/>

                                <!-- Item List -->
                                <TextBlock Text="Items:" FontWeight="Bold" Margin="0,5,0,2"/>

                                <ListBox 
                                        x:Name="PlayerItemListBox" 
                                        ItemsSource="{Binding Items}"
                                        SelectedItem="{Binding DataContext.ExpandedItem, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">

                                                <TextBox Text="{Binding Name, Mode=TwoWay}" Width="120"/>

                                                <Button Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource RemoveItemConverter}">

                                                            <!-- Item -->
                                                            <Binding />

                                                            <!-- PlayerCharacter: DataContext of the parent ItemsControl -->
                                                            <Binding Path="DataContext" RelativeSource="{RelativeSource AncestorType=ItemsControl, AncestorLevel=1}" />

                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Image Source="pack://application:,,,/Resources/icon-delete.png"/>
                                                </Button>
                                                <ContentControl Visibility="{Binding ExpandedVisibility}" Content="{Binding DataContext.ExpandedItemViewModel,RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <Button Content="Add Item" Command="{Binding DataContext.AddItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}"/>

                            </StackPanel>
                        </Border>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <Button Content="Add New Player" Command="{Binding AddNewPlayerCommand}"/>


        </StackPanel>
    </ScrollViewer>

</UserControl>
